> Tags: #SDM #硬盘 #CFast卡

- [1 B03.033 通过SDM查看存储设备的健康情况](#1%20B03.033%20%E9%80%9A%E8%BF%87SDM%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E7%9A%84%E5%81%A5%E5%BA%B7%E6%83%85%E5%86%B5)
- [2 数据存储介质的状态](#2%20%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E4%BB%8B%E8%B4%A8%E7%9A%84%E7%8A%B6%E6%80%81)
- [3 注意事项](#3%20%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9)
- [4 存储设备健康状态分析说明](#4%20%E5%AD%98%E5%82%A8%E8%AE%BE%E5%A4%87%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81%E5%88%86%E6%9E%90%E8%AF%B4%E6%98%8E)
- [5 更新日志](#5%20%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97)

# 1 B03.033 通过SDM查看存储设备的健康情况

- 存储介质的使用寿命有限。存储介质的磨损也会随着写入操作次数的增加而增加。为避免因存储介质故障而导致机器停机，应监控存储介质的使用寿命，并在合适的时间进行替换。
    - ![](FILES/033通过SDM查看存储设备的健康情况-Storage%20wear/image-20240317222938553.png)
- 可通过 SDM 在线查看存储设备（CF卡，CFast卡，硬盘）的健康情况
    - ![](FILES/033通过SDM查看存储设备的健康情况-Storage%20wear/image-20240317222825148.png)
- 分析方式基于 Self-Monitoring, Analysis and Reporting Technology (S.M.A.R.T.) 方式实现
- 要从不同的存储介质中读取健康数据，必须满足以下要求：
    - 存储介质：
        - SSD
        - CompactFlash
        - CFast
    - 引用信息
        - ATA-8 ACS standard, draft 6a
        - ATA-8 appendix about S.M.A.R.T. attributes

# 2 数据存储介质的状态

- 根据现有的健康数据计算数据存储介质的状况（磨损）
- 0% - 新数据存储介质
- 90% - ⚠️阈值警告。准备好新的数据存储介质。
- 100% - 🔴（预期使用寿命）更换数据存储介质。
- `> 100%` - 🔴超过预期使用寿命。更换数据存储介质。

# 3 注意事项

- 数据健康分析需要较高的AR版本（ > AR4.90）
- 当使用第三方可移动媒体时，存储健康数据的功能受到严重限制。在这种情况下，只能使用功能块 ArStorageGetHealthData 读取未处理的健康数据。
    - 在这种情况下，无法使用自动监控或通过数据点 StorageWear 或功能块 ArStorageGetWear 读取数据存储介质状态等高级功能。
- 不支持旧版 B&R 可移动存储介质或带有固定存储介质的旧版 B&R 设备

# 4 存储设备健康状态分析说明

- Automation Studio 和 Automation Runtime 提供以下选项用于监控数据存储介质的状态：
    - **Automatic monitoring**
        - Automation Runtime 持续监控存储介质的状态。如果超过 90% 的阈值，则会在Logger中输入警告
        - 只有相应的 AR 更新版本才支持新的数据存储介质。因此，B&R 推荐使用功能块 ArStorageGetHealthData，因为它的工作方式与所使用的数据存储介质无关。
    - **ArStorage**
        - 数据存储介质的状态和原始健康数据以及序列号和型号均通过 ArStorage 库中的功能块提供。
    - **Data point**
        - 数据点 StorageWear 指定数据存储介质的当前状态（百分比）。如果无法确定数据存储介质的状态（不支持数据存储介质、无状态数据），则数据点的值为 65535
    - **SDM view**
        - 数据点 StorageWear 显示在 "系统诊断管理器（SDM） "的 "系统 "和 "硬件 - I/O 信息 "页面上。
    - **SDM dump**
        - 存储介质的原始健康数据在系统诊断管理器（SDM）的系统转储中提供。

# 5 更新日志

| 日期     | 修改人     | 修改内容     |
|:-----|:-----|:-----|
| 2024-03-17     | YuanZhiyi     | 初次创建     |
